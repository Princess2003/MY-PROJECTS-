<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Employee</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100vh;
            background-color: #f5f5f5;
            color: #34495e;
        }

        .container {
            background-color: #fff;
            padding: 40px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin: 20px;
            text-align: left;
        }

        h1 {
            text-align: center;
            margin-bottom: 50px;
        }

        form {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-group {
            flex: 1 1 calc(50% - 20px);
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }

        .form-group label {
            margin-bottom: 5px;
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        .form-group input[type="file"] {
            padding: 3px;
        }

        .form-group input[type="submit"], .form-group input[type="reset"] {
            padding: 10px 20px;
            background-color: #2980b9;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .form-group input[type="reset"] {
            background-color: #95a5a6;
        }

        .form-group input[type="submit"]:hover, .form-group input[type="reset"]:hover {
            background-color: #3498db;
        }

        .form-group input[type="reset"]:hover {
            background-color: #7f8c8d;
        }
        

    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        document.addEventListener("DOMContentLoaded", function() {
            console.log("Script started executing.");

            const firebaseConfig = {
            apiKey: "AIzaSyBI4ZArCtlBmGl6iYLxCHfK68ztVqIO5bI",
            authDomain: "reliablehouse-df437.firebaseapp.com",
            projectId: "reliablehouse-df437",
            storageBucket: "reliablehouse-df437.appspot.com",
            messagingSenderId: "491568569315",
            appId: "1:491568569315:web:d34bc70fc7e3f509b25ed6"
            };

            console.log("Initializing Firebase app...");
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const storage = getStorage(app);
            console.log("Firebase app initialized.");

            async function addEmployeeToFirestore(employeeData) {
                try {
                    console.log("Adding employee to Firestore...");
                    const docRef = await addDoc(collection(db, "employees"), employeeData);
                    console.log("Document written with ID: ", docRef.id);
                } catch (e) {
                    console.error("Error adding document: ", e);
                    throw e;
                }
            }

            async function uploadProfileImage(file) {
                const storageRef = ref(storage, 'profileImages/' + file.name);
                console.log("Uploading profile image...");
                await uploadBytes(storageRef, file);
                console.log("Profile image uploaded.");
                return getDownloadURL(storageRef);
            }

            document.getElementById("employee-form").addEventListener("submit", async function(event) {
                event.preventDefault();
                console.log("Form submitted");

                const fileInput = document.getElementById("pfimg");
                const file = fileInput.files[0];

                if (!file) {
                    alert("Please select a profile image.");
                    return;
                }

                try {
                    const pfimgUrl = await uploadProfileImage(file);
                    const employeeData = {
                        empid: document.getElementById("empid").value,
                        pfimg: pfimgUrl,
                        gender: document.getElementById("gender").value,
                        fname: document.getElementById("fname").value,
                        mname: document.getElementById("mname").value,
                        lname: document.getElementById("lname").value,
                        bdate: document.getElementById("bdate").value,
                        marital: document.getElementById("marital").value,
                        mnumber: document.getElementById("mnumber").value,
                        address1: document.getElementById("address1").value,
                        address2: document.getElementById("address2").value,
                        address3: document.getElementById("address3").value,
                        joindate: document.getElementById("joindate").value,
                        status: document.getElementById("status").value,
                        role: document.getElementById("role").value,
                        position: document.getElementById("position").value,
                        email: document.getElementById("email").value,
                        password: document.getElementById("password").value,
                    };

                    console.log("Employee Data:", employeeData);

                    await addEmployeeToFirestore(employeeData);

                    alert("Employee added successfully!");
                    document.getElementById("employee-form").reset();
                    window.location.href = "homepage.html";
                } catch (error) {
                    console.error("Error adding employee: ", error);
                    alert("Error adding employee: " + error.message);
                }
            });
        });
    </script>
</head>
<body>
    
    <div class="container">
        <h1>--------------</h1>
        <h1>--------------</h1>
        <h1>--------------</h1>
        <h1>--------------</h1>
        <h1>--------------</h1>
        <h1>--------------</h1>
        <h1>Add Employee</h1>
        <h1>--------------</h1>
        <h1>--------------</h1>
        <form id="employee-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="empid">Employee ID*</label>
                <input type="text" name="empid" id="empid" placeholder="Employee ID" required>
            </div>

            <div class="form-group">
                <label for="pfimg">Profile Image*</label>
                <input type="file" name="pfimg" id="pfimg" required>
            </div>

            <div class="form-group">
                <label for="gender">Gender*</label>
                <select name="gender" id="gender" required>
                    <option value="">-- Select Gender --</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>

            <div class="form-group">
                <label for="fname">First Name*</label>
                <input type="text" name="fname" id="fname" placeholder="First Name" required>
            </div>

            <div class="form-group">
                <label for="mname">Middle Name*</label>
                <input type="text" name="mname" id="mname" placeholder="Middle Name" required>
            </div>

            <div class="form-group">
                <label for="lname">Last Name*</label>
                <input type="text" name="lname" id="lname" placeholder="Last Name" required>
            </div>

            <div class="form-group">
                <label for="bdate">Birth Date*</label>
                <input type="date" name="bdate" id="bdate" required>
            </div>

            <div class="form-group">
                <label for="marital">Marital Status*</label>
                <select name="marital" id="marital" required>
                    <option value="">-- Select Marital Status --</option>
                    <option value="single">Single</option>
                    <option value="married">Married</option>
                    <option value="divorced">Divorced</option>
                </select>
            </div>

            <div class="form-group">
                <label for="mnumber">Mobile Number*</label>
                <input type="text" name="mnumber" id="mnumber" placeholder="Mobile Number" required>
            </div>

            <div class="form-group">
                <label for="address1">Address 1*</label>
                <input type="text" name="address1" id="address1" placeholder="Address Line 1" required>
            </div>

            <div class="form-group">
                <label for="address2">Address 2*</label>
                <input type="text" name="address2" id="address2" placeholder="Address Line 2" required>
            </div>

            <div class="form-group">
                <label for="address3">Address 3</label>
                <input type="text" name="address3" id="address3" placeholder="Address Line 3">
            </div>

            <div class="form-group">
                <label for="joindate">Join Date*</label>
                <input type="date" name="joindate" id="joindate" required>
            </div>

            <div class="form-group">
                <label for="status">Status*</label>
                <select name="status" id="status" required>
                    <option value="">-- Select Status --</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>

            <div class="form-group">
                <label for="role">Role*</label>
                <input type="text" name="role" id="role" placeholder="Role" required>
            </div>

            <div class="form-group">
                <label for="position">Position*</label>
                <input type="text" name="position" id="position" placeholder="Position" required>
            </div>

            <div class="form-group">
                <label for="email">Email*</label>
                <input type="email" name="email" id="email" placeholder="Email" required>
            </div>

            <div class="form-group">
                <label for="password">Password*</label>
                <input type="password" name="password" id="password" placeholder="Password" required>
            </div>

            <div class="form-group">
                <input type="submit" value="Add Employee">
                <input type="reset" value="Reset">
            </div>
        </form>
    </div>
</body>
</html>
